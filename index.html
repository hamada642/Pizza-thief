<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø³Ø§Ø±Ù‚ Ø§Ù„Ø¨ÙŠØªØ²Ø§ ğŸ• - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
<style>
:root{
  --bg1:#071018; --bg2:#0b1720;
  --floor:#3a2b1f;
  --btn-size:66px;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Arial,Helvetica,sans-serif;color:#fff;overflow:hidden}
#passwordScreen{
  position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:linear-gradient(180deg,#3a0a1a88, #000000aa);z-index:80;
  gap:10px;padding:18px;
}
#passwordScreen h1{margin:0;font-size:34px}
#passwordScreen input{font-size:18px;padding:12px 14px;border-radius:10px;border:none;outline:none}
#passwordScreen button{padding:10px 16px;border-radius:10px;border:none;background:#ff4d4d;color:#fff;font-weight:bold;cursor:pointer}
#UI{position:fixed;top:12px;left:12px;z-index:70;background:rgba(0,0,0,0.25);padding:8px 12px;border-radius:8px;font-size:18px}
#gameOver{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:90;text-align:center}
#gameOver h2{color:#ffd86b;margin:0 0 10px}
canvas{display:block;width:100vw;height:100vh;background:linear-gradient(180deg,#08121a,#05060a);}

/* mobile controls */
#mobileControls{
  position:fixed;left:0;right:0;bottom:10px;display:flex;justify-content:center;gap:10px;align-items:flex-end;z-index:75;padding:8px;pointer-events:none;
}
.controlBtn{
  pointer-events:auto;width:var(--btn-size);height:var(--btn-size);border-radius:50%;
  display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;
  color:#fff;border:none;cursor:pointer;user-select:none;
  box-shadow:0 6px 18px rgba(0,0,0,0.45);transition:transform .06s, filter .06s;
}
.controlBtn:active{transform:translateY(2px) scale(.98);filter:brightness(1.04)}
.leftBtn{background:linear-gradient(180deg,#5fb3ff,#1f7ed6)}
.rightBtn{background:linear-gradient(180deg,#3b82c4,#165b9a)}
.jumpBtn{background:linear-gradient(180deg,#7de08b,#2ea94f)}
.throwBtn{background:linear-gradient(180deg,#ff8a66,#d94a1b)}
.waterBtn{background:linear-gradient(180deg,#66f0ff,#18a6b0)}
.lightBtn{background:linear-gradient(180deg,#ffd86b,#f0a500)}
@media(min-width:900px){:root{--btn-size:54px}}
#hint{position:fixed;right:12px;top:12px;font-size:13px;color:#ddd;opacity:.9;z-index:70}
</style>
</head>
<body>
  <div id="passwordScreen" role="dialog" aria-label="Ø´Ø§Ø´Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <h1>ğŸ• Ø³Ø§Ø±Ù‚ Ø§Ù„Ø¨ÙŠØªØ²Ø§</h1>
    <div style="text-align:center;color:#ffe6cc">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø¨Ø¯Ø¡</div>
    <input id="pass" type="password" autocomplete="off" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
    <button id="enterBtn">Ø¯Ø®ÙˆÙ„</button>
    <div style="margin-top:8px;color:#fff;font-size:13px;opacity:.95">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: <strong>pizza2025</strong></div>
  </div>

  <div id="UI">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>

  <div id="gameOver" style="display:flex">
    <h2>ØªÙ… Ø§Ù„Ù‚Ø¨Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù„Øµ! ğŸ‰</h2>
    <div style="color:#fff;font-size:20px;margin-bottom:12px">Ø§Ù„Ù†Ù‚Ø§Ø·: <strong id="final">0</strong></div>
    <button onclick="location.reload()" style="padding:10px 18px;border-radius:8px;border:none;background:#2ecc71;color:#000;font-weight:bold;cursor:pointer">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
  </div>

  <canvas id="c"></canvas>

  <div id="mobileControls" aria-hidden="false">
    <button id="left" class="controlBtn leftBtn" aria-label="ÙŠØ³Ø§Ø±">â†</button>
    <button id="right" class="controlBtn rightBtn" aria-label="ÙŠÙ…ÙŠÙ†">â†’</button>
    <button id="jump" class="controlBtn jumpBtn" aria-label="Ù‚ÙØ²">â¤´</button>
    <button id="throw" class="controlBtn throwBtn" aria-label="Ø±Ù…ÙŠ">ğŸ“¦</button>
    <button id="water" class="controlBtn waterBtn" aria-label="Ù…Ø§Ø¡">ğŸ’§</button>
    <button id="light" class="controlBtn lightBtn" aria-label="Ù†ÙˆØ±">ğŸ’¡</button>
  </div>

<script>
/* Final single-file game.
   - Password: pizza2025
   - No external files, all sounds via Web Audio API
   - Mobile buttons + keyboard
*/

const PASSWORD = "pizza2025";

/* Audio */
let audioCtx = null;
let musicInterval = null;
function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
function playTone(freq, dur=0.12, type='sine', vol=0.12){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.setValueAtTime(freq, audioCtx.currentTime);
  g.gain.setValueAtTime(vol, audioCtx.currentTime);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(audioCtx.currentTime);
  o.stop(audioCtx.currentTime + dur);
}
function playSlip(){ playTone(720,0.09,'sawtooth',0.18); setTimeout(()=>playTone(480,0.1,'sawtooth',0.16),70); setTimeout(()=>playTone(320,0.18,'sawtooth',0.2),140); }
function playJump(){ playTone(520,0.12,'triangle',0.18); playTone(760,0.06,'sine',0.1); }
function playThrow(){ playTone(180,0.12,'square',0.22); setTimeout(()=>playTone(240,0.08,'square',0.14),70); }
function playWater(){ playTone(880,0.06,'sine',0.12); playTone(980,0.06,'sine',0.08); }
function playLight(){ playTone(1200,0.06,'sine',0.12); }
function playHit(){ playTone(360,0.08,'square',0.22); }

function startBackgroundMusic(){
  if(!audioCtx) return;
  if(musicInterval) clearInterval(musicInterval);
  const melody = [196, 247, 330, 262, 294, 330, 370];
  musicInterval = setInterval(()=>{
    const idx = Math.floor((Date.now()/300)) % melody.length;
    playTone(melody[idx], 0.26, 'square', 0.05);
  }, 260);
}
function stopBackgroundMusic(){
  if(musicInterval){ clearInterval(musicInterval); musicInterval = null; }
}

/* Canvas and game state */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let score = 0;
let speed = 4;
let gameActive = false;
let slipCooldown = 0;

const player = { x: 120, y: canvas.height - 220, width: 72, height: 110, vx:0, vy:0, onGround:true, color:'#22c55e' };
const thief  = { x: canvas.width - 220, y: canvas.height - 220, width:70, height:100, color:'#ef4444', slip:0 };

let boxes = [];
let waters = [];
let lightsOn = true;
let keys = {};

/* Controls */
function bindControls(){
  document.addEventListener('keydown', e => { keys[e.key] = true; });
  document.addEventListener('keyup', e => { keys[e.key] = false; });

  const mapping = { left:'ArrowLeft', right:'ArrowRight', jump:' ', throw:'x', water:'z', light:'c' };
  Object.keys(mapping).forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener('touchstart', ev => { ev.preventDefault(); keys[mapping[id]] = true; });
    el.addEventListener('touchend',   ev => { ev.preventDefault(); keys[mapping[id]] = false; });
    el.addEventListener('mousedown',  ev => { ev.preventDefault(); keys[mapping[id]] = true; });
    el.addEventListener('mouseup',    ev => { ev.preventDefault(); keys[mapping[id]] = false; });
    el.addEventListener('mouseleave', ev => { ev.preventDefault(); keys[mapping[id]] = false; });
  });
}

/* spawn helpers */
function spawnBox(){
  boxes.push({ x: player.x + player.width + 6, y: player.y + 30, vx: 12 + Math.random()*4, vy: -3, w: 56, h: 56 });
  playThrow();
}
function spawnWater(){
  waters.push({ x: player.x + player.width + 10, y: player.y + 40, life: 60 });
  playWater();
}

/* drawing */
function drawPizza(x,y,size=28){
  ctx.fillStyle = "#ffb84d";
  ctx.beginPath(); ctx.arc(x,y,size,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = "#b32a2a";
  ctx.beginPath(); ctx.arc(x - size*0.12, y - size*0.18, size*0.45, 0, Math.PI*2); ctx.fill();
}

/* game start / pass */
const passInput = document.getElementById('pass');
document.getElementById('enterBtn').addEventListener('click', checkPass);
passInput.addEventListener('keyup', e => { if(e.key === 'Enter') checkPass(); });

function checkPass(){
  if(passInput.value === PASSWORD){
    document.getElementById('passwordScreen').style.display = 'none';
    if(!audioCtx) initAudio();
    startBackgroundMusic();
    bindControls();
    startGame();
  } else {
    alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø· â€” Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ');
  }
}

/* main start */
function startGame(){
  gameActive = true;
  score = 0;
  speed = 4;
  boxes = []; waters = [];
  slipCooldown = 0;
  player.x = 120; player.y = canvas.height - 220; player.vy = 0; player.onGround = true;
  thief.x = canvas.width - 220; thief.y = canvas.height - 220; thief.slip = 0;
  requestAnimationFrame(loop);
}

/* main loop */
function loop(){
  if(!gameActive) return;

  // input
  if(keys['ArrowRight'] || keys['Ø¯']) player.x += 8;
  if(keys['ArrowLeft']  || keys['Ø§']) player.x -= 8;
  if((keys[' '] || keys['ArrowUp'] || keys['Ùˆ']) && player.onGround){
    player.vy = -18;
    player.onGround = false;
    playJump();
  }
  if((keys['x'] || keys['Ø³']) && Math.random() < 0.16){ spawnBox(); keys['x']=false; keys['Ø³']=false; }
  if((keys['z'] || keys['Ø²']) && Math.random() < 0.22){ spawnWater(); keys['z']=false; keys['Ø²']=false; }
  if((keys['c'] || keys['Ø¹'])){ keys['c']=false; keys['Ø¹']=false; lightsOn = !lightsOn; playLight(); }

  // physics
  player.vy += 1.2;
  player.y += player.vy;
  const groundY = canvas.height - 180;
  if(player.y >= groundY){ player.y = groundY; player.vy = 0; player.onGround = true; }

  if(player.x < 8) player.x = 8;
  if(player.x + player.width > canvas.width - 8) player.x = canvas.width - 8 - player.width;

  // thief
  thief.x -= speed;
  if(thief.slip > 0){ thief.slip--; thief.x -= 4; }
  if(thief.x < -120){
    thief.x = canvas.width + 120;
    speed += 0.5;
    score += 500;
    playSlip();
  }

  // update boxes
  for(let i = boxes.length -1; i >=0; i--){
    const b = boxes[i];
    b.x += b.vx; b.vy += 0.6; b.y += b.vy;
    if(b.x > thief.x && b.x < thief.x + thief.width && Math.abs(b.y - thief.y) < 80){
      thief.slip = 90; score += 100; playHit(); boxes.splice(i,1); continue;
    }
    if(b.y > canvas.height + 50 || b.x > canvas.width + 200) boxes.splice(i,1);
  }

  // update waters
  for(let i = waters.length -1; i >=0; i--){
    const w = waters[i];
    w.life--;
    if(w.x < thief.x + 120 && w.x > thief.x - 80){
      thief.slip = 100; score += 150; playHit();
    }
    if(w.life <= 0) waters.splice(i,1);
  }

  if(slipCooldown > 0) slipCooldown--;
  if(thief.slip > 20 && slipCooldown <= 0){
    playSlip(); slipCooldown = 50;
  }

  // draw
  drawScene();

  // collision player/thief - end game
  if(player.x + player.width > thief.x && player.x < thief.x + thief.width && Math.abs(player.y - thief.y) < 120){
    gameActive = false;
    stopBackgroundMusic();
    playHit(); setTimeout(()=>playHit(),180); setTimeout(()=>playHit(),360);
    document.getElementById('final').innerText = score;
    document.getElementById('gameOver').style.display = 'flex';
    return;
  }

  document.getElementById('score').innerText = score;
  requestAnimationFrame(loop);
}

/* drawing scene */
function drawScene(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // background gradient
  const g = ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,'#07101a'); g.addColorStop(1,'#02060a');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

  // floor
  ctx.fillStyle = '#3a2b1f';
  ctx.fillRect(0, canvas.height - 180, canvas.width, 180);

  // floor tiles
  for(let i=0;i<canvas.width;i+=120){
    ctx.fillStyle = '#5c4635';
    ctx.fillRect(i, canvas.height - 260, 80, 80);
  }

  // boxes
  boxes.forEach(b=>{
    ctx.fillStyle = '#7a2f18'; ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.fillStyle = '#ffda77'; ctx.fillRect(b.x+8,b.y+8,b.w-16,b.h-16);
  });

  // waters
  waters.forEach(w=>{
    for(let k=0;k<8;k++){
      ctx.fillStyle = 'rgba(0,150,255,0.35)';
      ctx.fillRect(w.x + (Math.random()*40-20), player.y + 30 + k*6, 6, 18);
    }
  });

  // player
  ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, player.width, player.height);
  ctx.fillStyle = '#fff'; ctx.fillRect(player.x + 14, player.y + 16, 44, 44);
  drawPizza(player.x + player.width/2, player.y - 22, 28);

  // thief
  ctx.fillStyle = thief.color; ctx.fillRect(thief.x, thief.y, thief.width, thief.height);
  ctx.fillStyle = '#000'; ctx.fillRect(thief.x + 12, thief.y + 14, 38, 38);
  ctx.fillStyle = '#fff'; ctx.fillRect(thief.x + 22, thief.y + 24, 18, 18);
  drawPizza(thief.x + thief.width/2, thief.y - 26, 32);

  // darkness / light hole
  if(!lightsOn){
    ctx.fillStyle = 'rgba(0,0,0,0.72)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.save(); ctx.beginPath();
    ctx.arc(player.x + player.width/2, player.y + player.height/2, Math.min(260, canvas.width*0.35), 0, Math.PI*2);
    ctx.clip();
    // redraw small part so it looks like a light hole
    ctx.fillStyle = '#5c4635'; ctx.fillRect(0, canvas.height - 260, canvas.width, 260);
    ctx.restore();
  }
}

/* cleanup */
window.addEventListener('beforeunload', ()=>{
  stopBackgroundMusic();
  if(musicInterval) clearInterval(musicInterval);
});

</script>
</body>
</html>

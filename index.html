<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø³Ø§Ø±Ù‚ Ø§Ù„Ø¨ÙŠØªØ²Ø§ - Ù…Ø¹ ØªØ­ÙƒÙ… Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙƒØ§Ù…Ù„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body,html{margin:0;height:100%;overflow:hidden;background:#000;font-family:Arial}
  #passwordScreen{background:linear-gradient(#400, #000);color:#fff;text-align:center;padding-top:15vh;height:100vh}
  input,button{padding:15px 25px;font-size:22px;border-radius:12px;margin:10px;border:none}
  button{background:#c00;color:#fff;cursor:pointer}
  canvas{display:block;background:#222}
  #gameUI{position:absolute;top:10px;left:10px;color:#fff;font-size:24px;z-index:10}
  #gameOver{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);color:#f33;text-align:center;padding-top:20vh;display:none;font-size:40px}
  
  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  #mobileControls{position:fixed;bottom:0;left:0;width:100%;height:200px;pointer-events:none;z-index:20;opacity:0.9}
  .controlBtn{
    position:absolute;
    bottom:20px;
    width:60px;
    height:60px;
    border-radius:50%;
    border:none;
    background-size:60% 60%;
    background-repeat:no-repeat;
    background-position:center;
    pointer-events:auto;
    box-shadow:0 3px 8px rgba(0,0,0,0.4);
    transition:transform 0.1s;
    background-color: #555; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù… ØªØ¸Ù‡Ø± */
  }
  .controlBtn:active{
    transform:scale(0.95);
    filter:brightness(1.2);
  }
  /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø¯Ù…Ø¬Ø© (base64 SVG) Ù„ÙƒÙ„ Ø²Ø± */
  #left {
    left:20px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHBvbHlnb24gcG9pbnRzPSIzNSwxMCwzNSw1MCwxNSwzMCIvPjwvc3ZnPg==");
  }
  #right {
    left:100px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHBvbHlnb24gcG9pbnRzPSIxNSwxMCLMIzE1LDUwLDM1LDMwIi8+PC9zdmc+");
  }
  #jump {
    bottom:100px;
    left:60px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHBvbHlnb24gcG9pbnRzPSIzMCwxMCwxMCwzMCw1MCwzMCIvPjwvc3ZnPg==");
  }
  #throw {
    right:20px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHJlY3QgeD0iMTUiIHk9IjIwIiB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIGZpbGw9IiNmYmIiLz48L3N2Zz4=");
  }
  #water {
    right:100px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHJlY3QgeD0iMjAiIHk9IjE1IiB3aWR0aD0iMjAiIGhlaWdodD0iMzAiIGZpbGw9IiMwOWYiLz48L3N2Zz4=");
  }
  #light {
    bottom:100px;
    right:60px;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCI+PHBvbHlnb24gcG9pbnRzPSIzMCwxNSwxNSwzMCw0NSwzMCIvPjwvc3ZnPg==");
  }

  /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ */
  @media (min-width:768px){
    .controlBtn{width:50px;height:50px;background-size:60% 60%;}
    #mobileControls{opacity:0.3;transform:scale(0.7);bottom:-20px;}
  }
</style>
</head>
<body>

<div id="passwordScreen">
  <h1>ğŸ• Ø³Ø§Ø±Ù‚ Ø§Ù„Ø¨ÙŠØªØ²Ø§ ğŸ•</h1>
  <p>Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¯ÙŠ Ø®Ø§ØµØ© Ø¬Ø¯Ù‹Ø§</p>
  <input type="password" id="pass" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" autocomplete="off">
  <br>
  <button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="UI">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
<div id="gameOver">ØªÙ… Ø§Ù„Ù‚Ø¨Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù„Øµ! ğŸ‰<br>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="final">0</span><br><br><button onclick="location.reload()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button></div>
<canvas id="c"></canvas>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
<div id="mobileControls">
  <button id="left" class="controlBtn" title="ÙŠØ³Ø§Ø±"></button>
  <button id="right" class="controlBtn" title="ÙŠÙ…ÙŠÙ†"></button>
  <button id="jump" class="controlBtn" title="Ù‚ÙØ²"></button>
  <button id="throw" class="controlBtn" title="Ø±Ù…ÙŠ ÙƒØ±ØªÙˆÙ†"></button>
  <button id="water" class="controlBtn" title="Ø±Ø´ Ù…ÙŠØ§Ù‡"></button>
  <button id="light" class="controlBtn" title="Ø¥Ø·ÙØ§Ø¡ Ù†ÙˆØ±"></button>
</div>

<script>
const PASSWORD = "pizza2025";
let audioCtx, bgInterval, slipCooldown=0;
function initAudio(){
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
function playTone(freq,dur=0.1,type='sine',vol=0.2){
  if(!audioCtx) return;
  const osc=audioCtx.createOscillator();
  const gainNode=audioCtx.createGain();
  osc.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
  osc.type=type;
  gainNode.gain.setValueAtTime(vol,audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+dur);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime+dur);
}
function playSlip(){playTone(600,0.12,'sawtooth',0.25); setTimeout(()=>playTone(400,0.12,'sawtooth',0.25),60); setTimeout(()=>playTone(250,0.25,'sawtooth',0.3),120);}
function playVictory(){setTimeout(()=>playTone(523,0.18,'sine',0.3),0); setTimeout(()=>playTone(659,0.18,'sine',0.3),180); setTimeout(()=>playTone(784,0.18,'sine',0.3),360); setTimeout(()=>playTone(1047,0.4,'sine',0.4),540);}
function playJump(){playTone(420,0.18,'sine',0.25);}
function playBoxThrow(){playTone(180,0.15,'square',0.3);}
function playWaterSplash(){playTone(720,0.08,'sine',0.25); playTone(920,0.08,'sine',0.25);}
function playHit(){playTone(480,0.12,'square',0.28);}
function playLightToggle(){playTone(1200,0.1,'sine',0.2);}
function playEscape(){playTone(350,0.18,'triangle',0.22);}
function checkPass(){
  if(document.getElementById("pass").value === PASSWORD){
    document.getElementById("passwordScreen").style.display="none";
    initAudio();
    initControls();
    startGame();
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø· ÙŠØ§ Ø­Ø±Ø§Ù…ÙŠ ğŸ˜¡");
  }
}
document.getElementById("pass").addEventListener("keyup", e => e.key === "Enter" && checkPass());

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let score = 0, speed = 4, gameActive = true;
const player = { x:100, y:canvas.height-200, width:80, height:120, color:"#0b0", onGround:true };
const thief  = { x:canvas.width-200, y:canvas.height-180, width:70, height:100, color:"#c00", slip:0 };
let boxes = [], waters = [], lightsOn = true, keys = {};

function initControls(){
  document.addEventListener("keydown", e => keys[e.key] = "1");
  document.addEventListener("keyup",   e => keys[e.key] = null);
  const controls = { left:'ArrowLeft', right:'ArrowRight', jump:' ', throw:'x', water:'z', light:'c' };
  Object.keys(controls).forEach(id => {
    const btn = document.getElementById(id);
    btn.addEventListener('touchstart', e => { e.preventDefault(); keys[controls[id]] = "1"; });
    btn.addEventListener('touchend',   e => { e.preventDefault(); keys[controls[id]] = null; });
    btn.addEventListener('mousedown',  () => keys[controls[id]] = "1");
    btn.addEventListener('mouseup',    () => keys[controls[id]] = null);
    btn.addEventListener('mouseleave', () => keys[controls[id]] = null);
  });
}

function spawnBox(){
  boxes.push({ x:player.x+100, y:player.y+40, vx:12, vy:-3, w:60, h:60 });
  playBoxThrow();
}
function spawnWater(){
  waters.push({ x:player.x+100, y:player.y+60, life:60 });
  playWaterSplash();
}
function drawPizza(x,y,size=40){
  ctx.fillStyle="#f90"; ctx.beginPath(); ctx.arc(x,y,size); ctx.fill();
  ctx.fillStyle="#c33"; ctx.beginPath(); ctx.arc(x,y, size*0.7); ctx.fill();
}

function startGame(){
  const scale = [196,220,247,262,294,330,370,392,440,494,554,587];
  bgInterval = setInterval(()=>{
    const idx = Math.floor(Date.now()/700) % scale.length;
    playTone(scale[idx],0.4, 'square', 0.07);
  }, 380);
  gameLoop();
}

function gameLoop(){
  if(!gameActive) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ¬Ø±
  ctx.fillStyle="#444"; ctx.fillRect(0,canvas.height-100,canvas.width,100);
  for(let i=0;i<canvas.width;i+=120){
    ctx.fillStyle="#654";
    ctx.fillRect(i, canvas.height-180, 80, 80);
  }

  // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
  if(keys["ArrowRight"] || keys["Ø¯"]) player.x += 9;
  if(keys["ArrowLeft"]  || keys["Ø§"]) player.x -= 9;
  if((keys[" "] || keys["ArrowUp"] || keys["Ùˆ"]) && player.onGround){
    player.y -= 20; player.onGround = false; playJump();
  }
  player.y += 8;
  if(player.y > canvas.height-200){
    player.y = canvas.height-200; player.onGround = true;
  }

  // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Øµ
  thief.x -= speed;
  if(thief.slip > 0){
    thief.slip--;
    thief.x -= 4;
  }
  if(thief.x < -100){
    thief.x = canvas.width + 100;
    speed += 0.5;
    score += 500;
    playEscape();
    return requestAnimationFrame(gameLoop);
  }

  // Ø±Ù…ÙŠ ÙƒØ±Ø§ØªÙŠÙ† Ø£Ùˆ Ù…ÙŠØ§Ù‡
  if(keys["x"] || keys["Ø³"]) if(Math.random()<0.15) spawnBox();
  if(keys["z"] || keys["Ø²"]) if(Math.random()<0.2) spawnWater();
  if(keys["c"] || keys["Ø¹"]){
    lightsOn = !lightsOn;
    playLightToggle();
    keys["c"] = keys["Ø¹"] = null;
  }

  // ÙƒØ±Ø§ØªÙŠÙ†
  boxes.forEach((b,i)=>{
    b.x += b.vx;
    b.vy += 0.4;
    b.y += b.vy;
    ctx.fillStyle="#840"; ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.fillStyle="#fb0"; ctx.fillRect(b.x+10,b.y+10,b.w-20,b.h-20);
    if(b.x > thief.x && b.x < thief.x + thief.width && Math.abs(b.y - thief.y) < 80){
      thief.slip = 80;
      score += 100;
      playHit();
      boxes.splice(i,1);
    }
    if(b.y > canvas.height) boxes.splice(i,1);
  });

  // Ù…ÙŠØ§Ù‡
  waters.forEach((w,i)=>{
    for(let j=0;j<15;j++){
      ctx.fillStyle="rgba(0,150,255,0.4)";
      ctx.fillRect(w.x + Math.random()*200 - 100, player.y + 60 + j*10, 8, 40);
    }
    if(w.x < thief.x + 100 && w.x > thief.x - 200){
      thief.slip = 100;
      score += 150;
      playHit();
    }
    w.life--;
    if(w.life <= 0) waters.splice(i,1);
  });

  if(slipCooldown > 0) slipCooldown--;
  if(thief.slip > 20 && slipCooldown <= 0){
    playSlip();
    slipCooldown = 40;
  }

  // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);
  ctx.fillStyle = "#fff";
  ctx.fillRect(player.x + 15, player.y + 20, 50, 50);
  drawPizza(player.x + 40, player.y - 20, 30);

  // Ø±Ø³Ù… Ø§Ù„Ù„Øµ
  ctx.fillStyle = thief.color;
  ctx.fillRect(thief.x, thief.y, thief.width, thief.height);
  ctx.fillStyle = "#000";
  ctx.fillRect(thief.x + 15, thief.y + 15, 40, 40);
  ctx.fillStyle = "#fff";
  ctx.fillRect(thief.x + 25, thief.y + 25, 20, 20);
  drawPizza(thief.x + 35, thief.y - 25, 35);

  // Ø¥Ø¶Ø§Ø¡Ø© (Ø¸Ù„Ø§Ù… + ÙØªØ­Ø© Ø¶ÙˆØ¡ Ø­ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨)
  if(!lightsOn){
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.beginPath();
    ctx.arc(player.x + player.width/2, player.y + player.height/2, 220, 0, Math.PI*2);
    ctx.clip();
    ctx.fillStyle = "#555";
    ctx.fillRect(0, canvas.height-100, canvas.width, 100);
    ctx.restore();
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
  document.getElementById("score").innerText = score;

  // ÙØ­Øµ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… â€” Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
  if(player.x + player.width > thief.x && player.x < thief.x + thief.width && Math.abs(player.y - thief.y) < 120){
    gameActive = false;
    clearInterval(bgInterval);
    playHit();
    setTimeout(playHit, 200);
    setTimeout(playHit, 400);
    document.getElementById("final").innerText = score;
    document.getElementById("gameOver").style.display = "block";
    return;
  }

  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>

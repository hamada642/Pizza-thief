<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>لعبة سرقة البيتزا</title>
<style>
  :root{
    --bg:#111827;
    --ground:#2b2b2b;
    --player:#3b82f6;
    --pizza:#f97316;
    --thief:#ef4444;
    --text:#f8fafc;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{background:linear-gradient(180deg,var(--bg) 0%, #0b1220 100%);color:var(--text);display:flex;align-items:center;justify-content:center}
  .game-wrap{width:900px;max-width:95vw;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15));border-radius:10px;box-shadow:0 10px 30px rgba(2,6,23,0.6);padding:16px}
  canvas{display:block;background:linear-gradient(180deg,#071227 0%, #012031 70%);border-radius:6px;max-width:100%;}
  .hud{display:flex;justify-content:space-between;margin-top:10px;align-items:center}
  .hud .left, .hud .right{display:flex;gap:12px;align-items:center}
  .badge{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;font-weight:600}
  .center{display:flex;gap:8px;align-items:center}
  .hint{opacity:0.8;font-size:13px}
  .overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center}
  .panel{background:rgba(3,7,18,0.8);backdrop-filter: blur(6px);padding:22px;border-radius:12px;text-align:center;box-shadow:0 6px 20px rgba(2,6,23,0.7)}
  .panel h1{margin:0 0 8px 0;font-size:22px}
  .panel p{margin:6px 0 12px 0;color:#cbd5e1}
  .btn{background:#10b981;color:white;padding:8px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn.red{background:#ef4444}
  footer{margin-top:10px;text-align:center;color:#94a3b8;font-size:12px}
  /* responsive */
  @media (max-width:520px){
    .game-wrap{padding:10px}
  }
</style>
</head>
<body>
<div class="game-wrap" style="position:relative">
  <canvas id="game" width="900" height="480"></canvas>

  <div class="hud" style="position:relative">
    <div class="left">
      <div class="badge">النتيجة: <span id="score">0</span></div>
      <div class="badge">حياتك: <span id="lives">3</span></div>
    </div>
    <div class="center hint">التحكم: ← → للحركة، ↑ للقفز. اجمع البيتزا، تجنّب السارق.</div>
    <div class="right">
      <button id="restart" class="btn" title="إعادة اللعب">إعادة</button>
    </div>
  </div>

  <div id="overlay" class="overlay" style="display:none">
    <div class="panel">
      <h1 id="overlay-title">Game Over</h1>
      <p id="overlay-msg">نهاية اللعبة</p>
      <div style="display:flex;gap:8px;justify-content:center">
        <button id="overlay-restart" class="btn">إعادة اللعب</button>
        <button id="overlay-share" class="btn red">نسخ رابط/مشاركة</button>
      </div>
    </div>
  </div>

  <footer>بسيطة وسريعة — لو تحب أجمّلها بصور/أصوات أقوم بذلك</footer>
</div>

<script>
/* لعبة Canvas بسيطة: جمع بيتزا وتجنّب السارق.
   التعليمات: انسخ الكود كاملًا في ملف index.html وافتحه.
*/

// إعداد القماش (canvas)
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// HUD عناصر
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const overlay = document.getElementById('overlay');
const overlayTitle = document.getElementById('overlay-title');
const overlayMsg = document.getElementById('overlay-msg');
const restartBtn = document.getElementById('restart');
const overlayRestart = document.getElementById('overlay-restart');
const overlayShare = document.getElementById('overlay-share');

// الحالة العامة
let keys = { left:false, right:false, up:false };
let score = 0;
let lives = 3;
let gameOver = false;

// الفيزياء الأساسية
const gravity = 0.9;
const groundY = H - 80;

// اللاعب
const player = {
  x: 80,
  y: groundY - 50,
  w: 44,
  h: 50,
  vx: 0,
  vy: 0,
  speed: 4.2,
  jumpPower: 15,
  onGround: true,
  color: '#3b82f6'
};

// عناصر البيتزا المتجمعة
let pizzas = [];
let thieves = [];

// مولد عشوائي
function rand(min,max){ return Math.random()*(max-min)+min; }

// إنشاء بيتزا
function spawnPizza(){
  const p = {
    x: rand(200, W-40),
    y: rand(40, groundY-60),
    r: 12 + Math.floor(rand(0,8)),
    vx: rand(-0.6,0.6),
    vy: 0,
    wobble: Math.random()*Math.PI*2,
    collected:false
  };
  pizzas.push(p);
}

// إنشاء لص (enemy)
function spawnThief(){
  // يتحرك أفقياً ويطارد اللاعب بشكل بسيط
  const t = {
    x: rand(200, W-80),
    y: groundY - 48,
    w: 46,
    h: 48,
    speed: 1.6 + Math.random()*1.6,
    dir: Math.random()<0.5?-1:1,
    color: '#ef4444',
    active:true
  };
  thieves.push(t);
}

// تحريك اللاعب ومعالجة المدخلات
function updatePlayer(){
  // تحكم
  if(keys.left) player.vx = -player.speed;
  else if(keys.right) player.vx = player.speed;
  else player.vx *= 0.75; // احتكاك بسيط

  // قفز
  if(keys.up && player.onGround){
    player.vy = -player.jumpPower;
    player.onGround = false;
  }

  // فيزياء
  player.vy += gravity*0.6;
  player.x += player.vx;
  player.y += player.vy;

  // حدود الشاشة
  if(player.x < 10) player.x = 10;
  if(player.x + player.w > W-10) player.x = W - 10 - player.w;

  // ارتطام بالأرض
  if(player.y + player.h >= groundY){
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
  }
}

// تحديث البيتزا
function updatePizzas(){
  for(let i=pizzas.length-1;i>=0;i--){
    const p = pizzas[i];
    p.wobble += 0.08;
    p.x += p.vx;
    if(p.x < 20 || p.x > W-20) p.vx *= -1;

    // تراكب مع اللاعب = جمع
    const dx = (player.x + player.w/2) - p.x;
    const dy = (player.y + player.h/2) - p.y;
    const dist = Math.hypot(dx,dy);
    if(dist < p.r + Math.max(player.w, player.h)/2){
      // جمع
      pizzas.splice(i,1);
      score += 1;
      scoreEl.textContent = score;
      // كلما جمعت بيتزا نعمل واحد ثاني بفترة قصيرة
      setTimeout(spawnPizza, 900);
      // أحيانًا نضيف لص جديد ليزيد التحدي
      if(Math.random() < 0.25) spawnThief();
    }
  }
}

// تحديث اللصوص
function updateThieves(){
  for(let t of thieves){
    if(!t.active) continue;
    // يتحرك باتجاه اللاعب
    if(player.x + player.w/2 < t.x + t.w/2) t.x -= t.speed;
    else t.x += t.speed;

    // حدود
    if(t.x < 10) t.x = 10;
    if(t.x + t.w > W-10) t.x = W-10 - t.w;

    // تصادم مع اللاعب => يفقد حياة
    if(rectIntersect(player.x,player.y,player.w,player.h, t.x, t.y, t.w, t.h)){
      // مؤقت تفادي تكرار الخسارة فورًا
      t.active = false;
      loseLife();
      // يعاود الظهور بعد ثانية ونصف
      setTimeout(()=>{ t.active = true; t.x = rand(100, W-120); }, 1400);
    }
  }
}

// دالة فحص مستطيلات
function rectIntersect(x1,y1,w1,h1, x2,y2,w2,h2){
  return !(x1+w1 < x2 || x1 > x2+w2 || y1+h1 < y2 || y1 > y2+h2);
}

// فقدان حياة
function loseLife(){
  lives -= 1;
  livesEl.textContent = lives;
  // تأثير بصري/صوت (لو أردت تضيف الأصوات لاحقاً)
  if(lives <= 0){
    endGame();
  }
}

// نهاية اللعبة
function endGame(){
  gameOver = true;
  overlay.style.display = 'flex';
  overlayTitle.textContent = 'انتهت اللعبة';
  overlayMsg.textContent = `حصلت على ${score} نقطة. (اضغط إعادة للّعب)`;
}

// إعادة الضبط والبدء
function resetGame(){
  score = 0;
  lives = 3;
  scoreEl.textContent = score;
  livesEl.textContent = lives;
  pizzas = [];
  thieves = [];
  player.x = 80; player.y = groundY - player.h; player.vx = 0; player.vy = 0; player.onGround = true;
  overlay.style.display = 'none';
  gameOver = false;
  // ابدأ مع 3 بيتز و1 لص
  for(let i=0;i<3;i++) spawnPizza();
  spawnThief();
}

// رسم اللاعب
function drawPlayer(){
  ctx.save();
  ctx.translate(player.x + player.w/2, player.y + player.h/2);
  // جسم
  ctx.fillStyle = player.color;
  roundRect(ctx, -player.w/2, -player.h/2, player.w, player.h, 6, true, false);
  // وجه (عيون)
  ctx.fillStyle = '#fff';
  ctx.fillRect(-8, -6, 5, 5);
  ctx.fillRect(4, -6, 5, 5);
  ctx.restore();
}

// رسم بيتزا
function drawPizza(p){
  ctx.save();
  ctx.translate(p.x, p.y);
  // قاعدة البيتزا (دائرة)
  ctx.beginPath();
  ctx.fillStyle = '#fdd835';
  ctx.arc(0,0,p.r,0,Math.PI*2);
  ctx.fill();
  // رشة صوص - مثلث
  ctx.beginPath();
  ctx.fillStyle = '#f97316';
  ctx.moveTo(-p.r*0.4, p.r*0.1);
  ctx.lineTo(0, p.r*0.8);
  ctx.lineTo(p.r*0.4, p.r*0.1);
  ctx.closePath();
  ctx.fill();
  // قطع (pepperoni)
  for(let i=0;i<3;i++){
    const a = i * Math.PI*2/3 + p.wobble*0.4;
    const rx = Math.cos(a)*(p.r*0.45);
    const ry = Math.sin(a)*(p.r*0.45);
    ctx.beginPath();
    ctx.fillStyle = '#b91c1c';
    ctx.arc(rx,ry,p.r*0.22,0,Math.PI*2);
    ctx.fill();
  }
  ctx.restore();
}

// رسم لص
function drawThief(t){
  ctx.save();
  ctx.translate(t.x, t.y);
  // جسم
  ctx.fillStyle = t.color;
  roundRect(ctx, 0, 0, t.w, t.h, 6, true, false);
  // قناع بسيط
  ctx.fillStyle = '#000';
  ctx.fillRect(6, 8, t.w-12, 10);
  ctx.restore();
}

// مستطيل منحنٍ
function roundRect(ctx,x,y,w,h,r,fill,stroke){
  if(typeof r === 'undefined') r = 5;
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

// رسم المشهد
function render(){
  // خلفية
  ctx.clearRect(0,0,W,H);
  // سماء بسيطة (غير ضروري)
  const grd = ctx.createLinearGradient(0,0,0,H);
  grd.addColorStop(0, '#071227');
  grd.addColorStop(1, '#001827');
  ctx.fillStyle = grd;
  ctx.fillRect(0,0,W,H);

  // بعض أبراج/مدينة صغيرة (ديكور)
  for(let i=0;i<6;i++){
    const bx = i*(W/6);
    ctx.fillStyle = 'rgba(255,255,255,0.02)';
    ctx.fillRect(bx+40, 40, 30, 80 + (i%3)*20);
  }

  // الأرض
  ctx.fillStyle = '#0b1220';
  ctx.fillRect(0, groundY, W, H-groundY);
  ctx.fillStyle = '#1f2937';
  ctx.fillRect(0, groundY+30, W, H-groundY-30);

  // رسومات البيتزا
  for(let p of pizzas) drawPizza(p);

  // رسومات اللصوص
  for(let t of thieves) {
    if(t.active) drawThief(t);
    else {
      // مؤشر مصاب (فلاش)
      ctx.save();
      ctx.globalAlpha = 0.4;
      drawThief(t);
      ctx.restore();
    }
  }

  // اللاعب
  drawPlayer();
}

// اللوب الرئيسي
let last = 0;
function loop(ts){
  if(gameOver) return;
  const dt = Math.min(40, ts - last);
  last = ts;

  // تحديثات
  updatePlayer();
  updatePizzas();
  updateThieves();

  // رسم
  render();

  requestAnimationFrame(loop);
}

// إدخال الكيبورد
window.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
  if(e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
  if(e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') keys.up = true;
  // منع السحب الافتراضي للمساحة
  if(e.key === ' '){ e.preventDefault(); }
});
window.addEventListener('keyup', (e)=>{
  if(e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
  if(e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
  if(e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') keys.up = false;
});

// أزرار HUD
restartBtn.addEventListener('click', ()=>{ resetGame(); last = performance.now(); requestAnimationFrame(loop); });
overlayRestart.addEventListener('click', ()=>{ resetGame(); last = performance.now(); requestAnimationFrame(loop); });
overlayShare.addEventListener('click', ()=>{
  // نسخ نص بسيط للمشاركة (يمكن تطويره لاحقاً)
  const txt = `لعبتي: Pizza Thief — نقطة: ${score}. العب الآن!`;
  navigator.clipboard?.writeText(txt).then(()=>{ alert('نُسخ رابط المشاركة/النص.'); }, ()=>{ alert('لم يتمكن المتصفح من النسخ.'); });
});

// بدء أولي
resetGame();
last = performance.now();
requestAnimationFrame(loop);

// إضافة بيتزا جديدة تلقائياً أحيانًا
setInterval(()=>{
  if(!gameOver && pizzas.length < 5) spawnPizza();
}, 3000);

</script>
</body>
</html>
